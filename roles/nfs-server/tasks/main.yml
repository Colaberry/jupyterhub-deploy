---
- name: install mdadm
  apt: update_cache=yes cache_valid_time=600 name=mdadm state=latest
  sudo: yes
  tags:
    - nfs

- name: run the lsi-cards script
  script: lsi-cards {{ ansible_fqdn }} /var/lib/docker/exports creates=/etc/{{ ansible_fqdn }}.raid-setup
  sudo: yes
  tags:
    - nfs

- name: install nfs server
  action: apt pkg=nfs-kernel-server state=present update_cache=yes
  tags:
    -nfs

- name: install nfs client
  action: apt pkg=nfs-common state=present
  tags:
    -nfs

- name: ensure nfs service is running
  action: service name={{item}} state=started
  when: is_debian_or_ubuntu
  tags:
    - nfs
  with_items:
    - nfs-kernel-server
